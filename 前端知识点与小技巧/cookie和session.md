# 			cookie和session的相关知识

浏览器发送请求是通过http协议来完成的，由于http是无状态的,  多次请求之间没有相关性，也就是说同一用户请求同一网站的不同页面，服务器无法识别是否是同一用户发起的请求。因此，用户无法进行连续的业务逻辑。

## 1.通过cookie和session来保持会话

###   1.1cookie: 浏览器端的存储数据的空间

- Cookie是由服务端生成的，发送给客户端（通常是浏览器）的。Cookie总是保存在客户端中，按在客户端中			的存储位置，可分为内存Cookie和硬盘Cookie：
- 内存Cookie由浏览器维护，保存在内存中，浏览器关闭后就消失了，其存在时间是短暂的。
- 硬盘Cookie保存在硬盘里，有一个过期时间，除非用户手工清理或到了过期时间，硬盘Cookie不会被删除，其存在时间是长期的。所以，按存在时间，可分为非持久Cookie和持久Cookie。

####     注意点：

- cookie中的数据 可以被同一个网站的页面所共享
- 不同浏览器的cookie 不能共享
- cookie的数据存储在浏览器中，每次请求服务器，在请求报文中携带cookie的数据，发送给服务器
- 服务器端无法直接操作cookie，是通过在服务器端设置响应头的的方式，通知浏览器对cookie进行设置，
- cookie中的数据有效期，不设置是会话级别的, 浏览器关闭，会话结束，数据销毁
- cookie存储容量小，约4kb



###  1.2 session: 服务器端存储数据的空间

Session代表服务器与浏览器的一次会话过程，这个过程是连续的，也可以时断时续的。Session是一种服务器端      的机制，Session 对象用来存储特定用户会话所需的信息。

Session由服务端生成，保存在服务器的内存、缓存、硬盘或[数据库](http://lib.csdn.net/base/mysql)中。

#### （1）session的基本操作

#####    开启session机制  (使用session前必须调用此方法)

```php
 session_start(); //开启session会话或者重用已经创建的会话。
```

**session_start();的作用：**

- 在服务器中随机生成一个sessionID


- 创建一个session会话文件，用于存储数据（文件名和session的相同，同一个会话只会创建一次）


- 在响应头中设置cookie,在cookie中存放本次会话的sessionID

然后将sessionID放在响应报文的响应头中，并告诉浏览器让浏览器设置在cookie

后续每次浏览器请求页面的时候将cookie中的sessionID携带过去，服务器验证sessionID一致则实现了会话保持。

![52984025785](C:\Users\Caitlyn\AppData\Local\Temp\1529840257850.png)

##### （3）作用

Session的根本作用就是在服务端存储用户和服务器会话的一些信息。典型的应用有：

1、判断用户是否登录。

2、购物车功能。

##### （4）缺陷

- Cookie会被附加在每个HTTP请求中，所以无形中增加了流量。
- 由于在HTTP请求中的Cookie是明文传递的，所以安全性成问题。（除非用HTTPS）
- Cookie的大小限制在4KB左右。对于复杂的存储需求来说是不够用的。

##### （5）、安全性（隐私策略）的不同 

Cookie存储在浏览器中，对客户端是可见的，客户端的一些程序可能会窥探、复制以至修正Cookie中的内容。而Session存储在服务器上，对客户端是透明的，不存在敏感信息泄露的风险。 假如选用Cookie，比较好的方法是，敏感的信息如账号密码等尽量不要写到Cookie中。最好是像Google、Baidu那样将Cookie信息加密，提交到服务器后再进行解密，保证Cookie中的信息只要本人能读得懂。而假如选择Session就省事多了，反正是放在服务器上，Session里任何隐私都能够有效的保护

## 2.用户退出登录的原理

#### 退出登录的实现方式分以下几种：

##### 2.1 服务器端让用户退出, 可以将 session 销毁

  将 session 销毁;
  session_destroy();

##### 2.2 服务器端让用户退出, 也可以清空session中标记信息

​    	unset($_SESSION['user_id']);

##### 2.3 设置cookie的有效期，在用户点击退出的时候，立即过期

​	语法：setcookie( key, value, 过期时间戳(1970开始) )

​	例子：

​	如果设置成过去的时间, 会将已设置的 cookie 销毁
   	setcookie( 'myname', '', time() - 1 );